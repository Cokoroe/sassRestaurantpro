-- V35__seed_role_feature_flags.sql
-- Fill roles.feature_flags (jsonb) for baseline roles used by FE to show/hide modules and actions.
-- Strategy: update by role.code (safe to re-run). Keeps existing ids for ROOT/OWNER.
-- IMPORTANT: keys are FULLY explicit (true/false) for all modules.

UPDATE roles
SET feature_flags = CASE code
    WHEN 'ROOT' THEN '{"qr":{"canViewConfig":true,"canManageConfig":true},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":true,"canManageMenu":true,"canToggleItem":true,"canViewCategory":true,"canManageCategory":true},"rbac":{"canViewRoles":true,"canManageRoles":true,"canViewPermissions":true,"canAssignPermissions":true,"canManagePermissions":true},"audit":{"canViewLogs":true,"canExportLogs":true},"staff":{"canView":true,"canManage":true,"canAssignRole":true},"orders":{"canView":true,"canClose":true,"canCancel":true,"canCreate":true,"canReopen":true,"canUpdate":true,"canDiscount":true},"shifts":{"canView":true,"canManage":true,"canRecordAttendance":true,"canApproveAttendance":true},"system":{"canViewSettings":true,"canUpdateSettings":true},"tables":{"canMerge":true,"canSplit":true,"canReserve":true,"canViewAreas":true,"canViewTables":true,"canManageAreas":true,"canChangeStatus":true,"canManageTables":true},"finance":{"canViewReport":true,"canExportReport":true},"kitchen":{"canViewTicket":true,"canUpdateTicket":true},"outlets":{"canView":true,"canManage":true},"reports":{"canExport":true,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":true},"tenants":{"canView":true,"canManage":true,"canChangePlan":true,"canViewBilling":true},"channels":{"canViewOnlineChannels":true,"canManageOnlineChannels":true},"payments":{"canView":true,"canCreate":true,"canRefund":true,"canPrintBill":true},"vouchers":{"canView":true,"canManage":true},"customers":{"canView":true,"canManage":true,"canViewLoyalty":true,"canAdjustLoyalty":true},"inventory":{"canView":true,"canAdjust":true,"canExport":true,"canImport":true,"canTransfer":true},"promotions":{"canView":true,"canManage":true},"restaurants":{"canView":true,"canManage":true},"integrations":{"canViewIntegrations":true,"canManageIntegrations":true},"reservations":{"canView":true,"canManage":true}}'::jsonb
    WHEN 'OWNER' THEN '{"qr":{"canViewConfig":true,"canManageConfig":true},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":true,"canManageMenu":true,"canToggleItem":true,"canViewCategory":true,"canManageCategory":true},"rbac":{"canViewRoles":true,"canManageRoles":true,"canViewPermissions":true,"canAssignPermissions":true,"canManagePermissions":false},"audit":{"canViewLogs":true,"canExportLogs":true},"staff":{"canView":true,"canManage":true,"canAssignRole":true},"orders":{"canView":true,"canClose":true,"canCancel":true,"canCreate":true,"canReopen":true,"canUpdate":true,"canDiscount":true},"shifts":{"canView":true,"canManage":true,"canRecordAttendance":true,"canApproveAttendance":true},"system":{"canViewSettings":true,"canUpdateSettings":true},"tables":{"canMerge":true,"canSplit":true,"canReserve":true,"canViewAreas":true,"canViewTables":true,"canManageAreas":true,"canChangeStatus":true,"canManageTables":true},"finance":{"canViewReport":true,"canExportReport":true},"kitchen":{"canViewTicket":true,"canUpdateTicket":true},"outlets":{"canView":true,"canManage":true},"reports":{"canExport":true,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":true},"tenants":{"canView":true,"canManage":true,"canChangePlan":true,"canViewBilling":true},"channels":{"canViewOnlineChannels":true,"canManageOnlineChannels":true},"payments":{"canView":true,"canCreate":true,"canRefund":true,"canPrintBill":true},"vouchers":{"canView":true,"canManage":true},"customers":{"canView":true,"canManage":true,"canViewLoyalty":true,"canAdjustLoyalty":true},"inventory":{"canView":true,"canAdjust":true,"canExport":true,"canImport":true,"canTransfer":true},"promotions":{"canView":true,"canManage":true},"restaurants":{"canView":true,"canManage":true},"integrations":{"canViewIntegrations":true,"canManageIntegrations":true},"reservations":{"canView":true,"canManage":true}}'::jsonb
    WHEN 'MANAGER' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":true,"canManageMenu":true,"canToggleItem":true,"canViewCategory":true,"canManageCategory":true},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":true,"canExportLogs":true},"staff":{"canView":true,"canManage":true,"canAssignRole":true},"orders":{"canView":true,"canClose":true,"canCancel":true,"canCreate":true,"canReopen":true,"canUpdate":true,"canDiscount":true},"shifts":{"canView":true,"canManage":true,"canRecordAttendance":true,"canApproveAttendance":true},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":true,"canSplit":true,"canReserve":true,"canViewAreas":true,"canViewTables":true,"canManageAreas":true,"canChangeStatus":true,"canManageTables":true},"finance":{"canViewReport":true,"canExportReport":false},"kitchen":{"canViewTicket":true,"canUpdateTicket":true},"outlets":{"canView":true,"canManage":false},"reports":{"canExport":true,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":true},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":true,"canCreate":true,"canRefund":true,"canPrintBill":true},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":true,"canManage":true,"canViewLoyalty":true,"canAdjustLoyalty":true},"inventory":{"canView":true,"canAdjust":true,"canExport":true,"canImport":true,"canTransfer":true},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":true,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":true,"canManage":true}}'::jsonb
    WHEN 'HR' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":false,"canViewMenu":false,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":false,"canManageCategory":false},"rbac":{"canViewRoles":true,"canManageRoles":false,"canViewPermissions":true,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":true,"canExportLogs":true},"staff":{"canView":true,"canManage":true,"canAssignRole":true},"orders":{"canView":false,"canClose":false,"canCancel":false,"canCreate":false,"canReopen":false,"canUpdate":false,"canDiscount":false},"shifts":{"canView":true,"canManage":true,"canRecordAttendance":true,"canApproveAttendance":true},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":false,"canSplit":false,"canReserve":false,"canViewAreas":false,"canViewTables":false,"canManageAreas":false,"canChangeStatus":false,"canManageTables":false},"finance":{"canViewReport":false,"canExportReport":false},"kitchen":{"canViewTicket":false,"canUpdateTicket":false},"outlets":{"canView":false,"canManage":false},"reports":{"canExport":true,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":true},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":false,"canCreate":false,"canRefund":false,"canPrintBill":false},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":false,"canManage":false,"canViewLoyalty":false,"canAdjustLoyalty":false},"inventory":{"canView":false,"canAdjust":false,"canExport":false,"canImport":false,"canTransfer":false},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":false,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":false,"canManage":false}}'::jsonb
    WHEN 'CASHIER' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":false,"canManageCategory":false},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":false,"canExportLogs":false},"staff":{"canView":false,"canManage":false,"canAssignRole":false},"orders":{"canView":true,"canClose":true,"canCancel":true,"canCreate":true,"canReopen":true,"canUpdate":true,"canDiscount":true},"shifts":{"canView":false,"canManage":false,"canRecordAttendance":false,"canApproveAttendance":false},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":false,"canSplit":false,"canReserve":true,"canViewAreas":true,"canViewTables":true,"canManageAreas":false,"canChangeStatus":true,"canManageTables":false},"finance":{"canViewReport":false,"canExportReport":false},"kitchen":{"canViewTicket":false,"canUpdateTicket":false},"outlets":{"canView":false,"canManage":false},"reports":{"canExport":false,"canViewSales":false,"canViewOrders":false,"canViewStaffPerformance":false},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":true,"canCreate":true,"canRefund":true,"canPrintBill":true},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":true,"canManage":true,"canViewLoyalty":true,"canAdjustLoyalty":true},"inventory":{"canView":false,"canAdjust":false,"canExport":false,"canImport":false,"canTransfer":false},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":false,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":true,"canManage":true}}'::jsonb
    WHEN 'WAITER' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":false,"canManageCategory":false},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":false,"canExportLogs":false},"staff":{"canView":false,"canManage":false,"canAssignRole":false},"orders":{"canView":true,"canClose":false,"canCancel":true,"canCreate":true,"canReopen":false,"canUpdate":true,"canDiscount":false},"shifts":{"canView":false,"canManage":false,"canRecordAttendance":false,"canApproveAttendance":false},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":true,"canSplit":true,"canReserve":true,"canViewAreas":true,"canViewTables":true,"canManageAreas":true,"canChangeStatus":true,"canManageTables":true},"finance":{"canViewReport":false,"canExportReport":false},"kitchen":{"canViewTicket":false,"canUpdateTicket":false},"outlets":{"canView":false,"canManage":false},"reports":{"canExport":false,"canViewSales":false,"canViewOrders":false,"canViewStaffPerformance":false},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":false,"canCreate":false,"canRefund":false,"canPrintBill":false},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":true,"canManage":true,"canViewLoyalty":true,"canAdjustLoyalty":true},"inventory":{"canView":false,"canAdjust":false,"canExport":false,"canImport":false,"canTransfer":false},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":false,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":true,"canManage":true}}'::jsonb
    WHEN 'KITCHEN' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":false,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":false,"canManageCategory":false},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":false,"canExportLogs":false},"staff":{"canView":false,"canManage":false,"canAssignRole":false},"orders":{"canView":true,"canClose":false,"canCancel":false,"canCreate":false,"canReopen":false,"canUpdate":false,"canDiscount":false},"shifts":{"canView":false,"canManage":false,"canRecordAttendance":false,"canApproveAttendance":false},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":false,"canSplit":false,"canReserve":false,"canViewAreas":false,"canViewTables":false,"canManageAreas":false,"canChangeStatus":false,"canManageTables":false},"finance":{"canViewReport":false,"canExportReport":false},"kitchen":{"canViewTicket":true,"canUpdateTicket":true},"outlets":{"canView":false,"canManage":false},"reports":{"canExport":false,"canViewSales":false,"canViewOrders":false,"canViewStaffPerformance":false},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":false,"canCreate":false,"canRefund":false,"canPrintBill":false},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":false,"canManage":false,"canViewLoyalty":false,"canAdjustLoyalty":false},"inventory":{"canView":false,"canAdjust":false,"canExport":false,"canImport":false,"canTransfer":false},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":false,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":false,"canManage":false}}'::jsonb
    WHEN 'INVENTORY' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":false,"canManageCategory":false},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":false,"canExportLogs":false},"staff":{"canView":false,"canManage":false,"canAssignRole":false},"orders":{"canView":false,"canClose":false,"canCancel":false,"canCreate":false,"canReopen":false,"canUpdate":false,"canDiscount":false},"shifts":{"canView":false,"canManage":false,"canRecordAttendance":false,"canApproveAttendance":false},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":false,"canSplit":false,"canReserve":false,"canViewAreas":false,"canViewTables":false,"canManageAreas":false,"canChangeStatus":false,"canManageTables":false},"finance":{"canViewReport":false,"canExportReport":false},"kitchen":{"canViewTicket":false,"canUpdateTicket":false},"outlets":{"canView":false,"canManage":false},"reports":{"canExport":false,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":false},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":false,"canCreate":false,"canRefund":false,"canPrintBill":false},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":false,"canManage":false,"canViewLoyalty":false,"canAdjustLoyalty":false},"inventory":{"canView":true,"canAdjust":true,"canExport":true,"canImport":true,"canTransfer":true},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":false,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":false,"canManage":false}}'::jsonb
    WHEN 'REPORT_VIEWER' THEN '{"qr":{"canViewConfig":false,"canManageConfig":false},"menu":{"canViewItem":true,"canViewMenu":true,"canManageItem":false,"canManageMenu":false,"canToggleItem":false,"canViewCategory":true,"canManageCategory":false},"rbac":{"canViewRoles":false,"canManageRoles":false,"canViewPermissions":false,"canAssignPermissions":false,"canManagePermissions":false},"audit":{"canViewLogs":true,"canExportLogs":true},"staff":{"canView":false,"canManage":false,"canAssignRole":false},"orders":{"canView":true,"canClose":false,"canCancel":false,"canCreate":false,"canReopen":false,"canUpdate":false,"canDiscount":false},"shifts":{"canView":false,"canManage":false,"canRecordAttendance":false,"canApproveAttendance":false},"system":{"canViewSettings":false,"canUpdateSettings":false},"tables":{"canMerge":false,"canSplit":false,"canReserve":false,"canViewAreas":true,"canViewTables":true,"canManageAreas":false,"canChangeStatus":false,"canManageTables":false},"finance":{"canViewReport":true,"canExportReport":true},"kitchen":{"canViewTicket":false,"canUpdateTicket":false},"outlets":{"canView":true,"canManage":false},"reports":{"canExport":true,"canViewSales":true,"canViewOrders":true,"canViewStaffPerformance":true},"tenants":{"canView":false,"canManage":false,"canChangePlan":false,"canViewBilling":false},"channels":{"canViewOnlineChannels":false,"canManageOnlineChannels":false},"payments":{"canView":true,"canCreate":false,"canRefund":false,"canPrintBill":false},"vouchers":{"canView":false,"canManage":false},"customers":{"canView":true,"canManage":false,"canViewLoyalty":true,"canAdjustLoyalty":false},"inventory":{"canView":true,"canAdjust":false,"canExport":false,"canImport":false,"canTransfer":false},"promotions":{"canView":false,"canManage":false},"restaurants":{"canView":true,"canManage":false},"integrations":{"canViewIntegrations":false,"canManageIntegrations":false},"reservations":{"canView":true,"canManage":false}}'::jsonb
    ELSE feature_flags
END,
updated_at = now()
WHERE code IN ('ROOT', 'OWNER', 'MANAGER', 'HR', 'CASHIER', 'WAITER', 'KITCHEN', 'INVENTORY', 'REPORT_VIEWER');

